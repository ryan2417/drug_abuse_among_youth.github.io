---
title: "Data tidy"
output: github_document
---

```{r}
library(tidyverse)
library(survey)
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  include = FALSE
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d(option = "viridis")
scale_fill_discrete = scale_fill_viridis_d(option = "viridis")
```

```{r}
yrbss_state_a <- readRDS("data/2019 states a-m.rds")
yrbss_state_z <- readRDS("data/2019 states n-z.rds")
yrbss_state = rbind(yrbss_state_a,yrbss_state_z)
yrbss_state = as_tibble(yrbss_state)
```

### 01～03
```{r}
yrbss_state
```



### 05～07
```{r}
yrbss_state
```



### 09～11
```{r}

```



### 13～15
```{r}
yrbss_state
```



### 17～19
```{r}
yrbss_state
```

```{r}
drug_use_tidy <- function(input_list){
  output <- case_when(input_list == 1 ~ 0,
                      input_list == 2 ~ 1.5,
                      input_list == 3 ~ 6,
                      input_list == 4 ~ 14.5,
                      input_list == 5 ~ 29.5,
                      input_list > 5 ~ 40)
  return(output)
}
drug_use_frequency <- function(input_list){
  output <- case_when(input_list == 0 ~ 0,
                      input_list > 0 & input_list < 40 ~ 1,
                      input_list > 40 ~ 2)
  return(output)
} 

age_tidy <- function(input_list) {
  output <- case_when(input_list == 1 ~ NA_real_,
                      input_list == 2 ~ 8,
                      input_list == 3 ~ 9.5,
                      input_list == 4 ~ 11.5,
                      input_list == 5 ~ 13.5,
                      input_list == 6 ~ 15.5,
                      input_list == 7 ~ 17.5)
}

```




```{r}
yrbss_state_tidy <-
  yrbss_state %>% 
  drop_na(q45, q46, q50, q51, q52, q53, q54, q55, q56) %>% 
  mutate(
    age_initial_alcohol = age_tidy(q40),
    age_initial_smoking = age_tidy(q31),
    age_marijuana = age_tidy(q46),
    marijuana = drug_use_tidy(q45),
    cocaine = drug_use_tidy(q50),
    inhale = drug_use_tidy(q51),
    heroin = drug_use_tidy(q52),
    methamphetamine = drug_use_tidy(q53),
    ecstasy = drug_use_tidy(q54),
    steroid = drug_use_tidy(q55),
    illegal_injection = case_when(q56 == 1 ~ 0,
                                  q56 == 2 ~ 20,
                                  q56 == 3 ~ 40),
    drug_use_sum = rowSums(across(marijuana:illegal_injection)),
    drug_use_freq = drug_use_frequency(drug_use_sum),
    marijuana_use_freq = drug_use_frequency(marijuana),
    cocaine_use_freq = drug_use_frequency(cocaine),
    inhale_use_freq = drug_use_frequency(inhale),
    heroin_use_freq = drug_use_frequency(heroin),
    methamphetamine_use_freq = drug_use_frequency(methamphetamine),
    ecstasy_use_freq = drug_use_frequency(ecstasy),
    steroid_use_freq = drug_use_frequency(steroid),
    illegal_injection_use_freq = drug_use_frequency(illegal_injection)
    )
```



